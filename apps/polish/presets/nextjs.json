{
  "extends": "base",
  "capabilities": {
    "shared": {
      "plugins": [
        { "type": "bundled", "name": "core-skills" }
      ]
    },
    "implement": {
      "systemPromptAppend": "You can create new files with Write. Use the existing Next.js patterns in the project."
    }
  },
  "metrics": [
    {
      "name": "testCoverage",
      "weight": 20,
      "command": "pnpm test:coverage 2>&1 | grep 'All files' | awk '{print $4}' | tr -d '%' || echo 0",
      "higherIsBetter": true,
      "target": 80
    },
    {
      "name": "testsFailing",
      "weight": 15,
      "command": "pnpm test 2>&1 | grep -c 'FAIL' || echo 0",
      "higherIsBetter": false,
      "target": 0
    },
    {
      "name": "typeErrors",
      "weight": 15,
      "command": "npx tsc --noEmit 2>&1 | grep -c 'error TS' || echo 0",
      "higherIsBetter": false,
      "target": 0
    },
    {
      "name": "lintErrors",
      "weight": 15,
      "command": "npx eslint . --format json 2>/dev/null | jq '[.[].errorCount] | add // 0'",
      "higherIsBetter": false,
      "target": 0
    },
    {
      "name": "codeStyle",
      "weight": 15,
      "command": "npx tsx scripts/check-code-style.ts",
      "higherIsBetter": true,
      "target": 90
    },
    {
      "name": "codeDuplication",
      "weight": 10,
      "command": "npx jscpd app/ lib/ --min-lines 5 --min-tokens 50 --ignore '**/*.json,**/*.md' 2>&1 | grep -o 'Found [0-9]* clones' | grep -o '[0-9]*' || echo 0",
      "higherIsBetter": false,
      "target": 0
    },
    {
      "name": "lintWarnings",
      "weight": 10,
      "command": "npx eslint . --format json 2>/dev/null | jq '[.[].warningCount] | add // 0'",
      "higherIsBetter": false,
      "target": 0
    }
  ],
  "strategies": [
    {
      "name": "add-tests",
      "focus": "testCoverage",
      "prompt": "Increase test coverage. Run `pnpm test:coverage` to see current coverage. Identify ONE file with low coverage in lib/ and add tests for its uncovered functions. Create the test file in lib/__tests__/."
    },
    {
      "name": "fix-tests",
      "focus": "testsFailing",
      "prompt": "Fix a failing test. Run `pnpm test` to see tests, identify ONE failing test, then fix it."
    },
    {
      "name": "fix-types",
      "focus": "typeErrors",
      "prompt": "Fix a TypeScript error. Run `npx tsc --noEmit` to see errors, then fix ONE single error."
    },
    {
      "name": "fix-lint",
      "focus": "lintErrors",
      "prompt": "Fix an ESLint error. Run `npx eslint . --format stylish` to see errors, then fix ONE single error."
    },
    {
      "name": "improve-code-style",
      "focus": "codeStyle",
      "prompt": "Improve code style. Identify ONE function too long (>50 lines) or ONE file too long (>500 lines) in lib/ or app/, then refactor it by extracting smaller functions or splitting the file. Ensure the code remains functional."
    },
    {
      "name": "reduce-duplication",
      "focus": "codeDuplication",
      "prompt": "Reduce code duplication. Run `npx jscpd app/ lib/` to see duplications, then extract ONE duplication into a reusable function."
    },
    {
      "name": "fix-warnings",
      "focus": "lintWarnings",
      "prompt": "Fix an ESLint warning. Run `npx eslint . --format stylish` to see warnings, then fix ONE single warning."
    }
  ]
}
